#!/bin/bash
# Centralized Gofr-Doc Configuration
# Source this file in all scripts and tests:
#   source "$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)/gofr-doc.env"
#
# Environment Modes:
#   GOFR_DOC_ENV=PROD  => uses $GOFR_DOC_ROOT/data
#   GOFR_DOC_ENV=TEST  => uses $GOFR_DOC_ROOT/test/data (default)

# Determine GOFR_DOC_ROOT - the project root directory
if [ -z "${GOFR_DOC_ROOT:-}" ]; then
    # Try to get from BASH_SOURCE first (when directly sourced)
    if [ -n "${BASH_SOURCE[0]:-}" ] 2>/dev/null; then
        GOFR_DOC_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
    elif [ -n "${PROJECT_ROOT:-}" ]; then
        # Use PROJECT_ROOT if set by caller (run_tests.sh sets this)
        GOFR_DOC_ROOT="${PROJECT_ROOT}"
    else
        # Fallback to current directory
        GOFR_DOC_ROOT="$(cd "." && pwd)"
    fi
fi

# Set environment mode (PROD or TEST)
export GOFR_DOC_ENV="${GOFR_DOC_ENV:-TEST}"

# Core directories
export GOFR_DOC_ROOT
export GOFR_DOC_LOGS="${GOFR_DOC_ROOT}/logs"

# Select data directory based on environment
if [ "$GOFR_DOC_ENV" = "PROD" ]; then
    export GOFR_DOC_DATA="${GOFR_DOC_ROOT}/data"
else
    export GOFR_DOC_DATA="${GOFR_DOC_ROOT}/test/data"
fi

# Data subdirectories (based on GOFR_DOC_ENV)
export GOFR_DOC_TEMPLATES="${GOFR_DOC_DATA}/docs/templates"
export GOFR_DOC_FRAGMENTS="${GOFR_DOC_DATA}/docs/fragments"
export GOFR_DOC_STYLES="${GOFR_DOC_DATA}/docs/styles"
export GOFR_DOC_STORAGE="${GOFR_DOC_DATA}/storage"

# Token store (always in logs directory)
export GOFR_DOC_TOKEN_STORE="${GOFR_DOC_LOGS}/gofr-doc_tokens.json"

# Create required directories if they don't exist
mkdir -p "$GOFR_DOC_LOGS"
mkdir -p "$GOFR_DOC_TEMPLATES"
mkdir -p "$GOFR_DOC_FRAGMENTS"
mkdir -p "$GOFR_DOC_STYLES"
mkdir -p "$GOFR_DOC_STORAGE"

# Server defaults - ports and hosts
export GOFR_DOC_HOST=${GOFR_DOC_HOST:-0.0.0.0}
export GOFR_DOC_MCP_PORT=${GOFR_DOC_MCP_PORT:-8000}
export GOFR_DOC_MCP_HOST=${GOFR_DOC_MCP_HOST:-$GOFR_DOC_HOST}
export GOFR_DOC_MCPO_PORT=${GOFR_DOC_MCPO_PORT:-8001}
export GOFR_DOC_MCPO_HOST=${GOFR_DOC_MCPO_HOST:-$GOFR_DOC_HOST}
export GOFR_DOC_WEB_PORT=${GOFR_DOC_WEB_PORT:-8002}
export GOFR_DOC_WEB_HOST=${GOFR_DOC_WEB_HOST:-$GOFR_DOC_HOST}

# Docker network configuration
export GOFR_DOC_NETWORK=${GOFR_DOC_NETWORK:-gofr-net}
